<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>INFO5100 Project3</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link href="https://fonts.googleapis.com/css?family=Josefin+Slab" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300|Source+Sans+Pro:300" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Pacifico" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://d3js.org/d3.v4.min.js"></script>
</head>

<body>

<div id="panel">

    <div id="logo">
        <img src="img/logo.png" width="60%">
    </div>

    <div id="titleTop">
        The Money Behind <br>The Senators
    </div>

    <div id="buttonSection">

        <div>
            <div class="left">
                <a onclick="goBack()" href="#">
                    <div id="btm_home">
                        <img src="img/btn_home.png" width="30%"><br>
                        Instruction

                    </div>
                </a>
            </div>
           <div class="right">
               <a onclick="funding()" href="#">
                   <div id="btm_play">
                       <img src="img/btn_play.png" width="30%"><br>
                       Check Funding
                   </div>
               </a>
           </div>
        </div>

        <div>
            <div class="left">
                <a onclick="topList()" href="#">
                    <div id="btm_top">
                        <img src="img/btn_top.png" width="30%"><br>
                        Top 6 Senators
                    </div>
                </a>
            </div>
            <div class="right">
                <a onclick="showReport()" href="#">
                    <div id="btm_report">
                        <img src="img/btn_report.png" width="30%"><br>
                        Party Preference
                    </div>
                </a>
            </div>
        </div>
    </div>

    <div id="tips">
        <div id="black1">
            <br>
            Instruction:
            <br>
            <br>
            - Hover over circle to see sponsor name and donation value for senator.
            <br>
            <br>
            - Click ”” to see detailed ranking of senators and sponsors
            <br>
            <br>
            - Click “Party Preference” to see top 10 donating companies and how their donation varies by party of senator.

        </div>
        <div id="black2">
            <div id="myProgress">
                <div id="myBar"></div>
            </div>
            <br>
            Check Fundings
            <br>
            <br>
            See how amount of funding received varies by party and state of belonging of senators in U.S. Larger size indicates more funding received.
            <br>
            <br>
            - Hover over circle to see sponsor name and donation value for senator.


        </div>
        <div id="black3">
            Top 6 and More Details
            <br>
            <br>
            See detailed sponsor information of top 6 senators who received most funding, and how major sponsors allocates their money.
            <br>
            <br>
            - Hover over senator image to see name and donation value of top 3 sponsors.
            <br>
            <br>
            - Hover over sponsor image to see who else this sponsor provides funds to in 2016.

        </div>
        <div id="black4">
            Party Preference
            <br>
            <br>
            See how top 10 donating companies allocate their money and how their sponsorship varies by party of senator.  Funding to Independent party are not represented due to small amount.
            <br>
            <br>
            Does their allocation matches your expectation?

        </div>
    </div>

    <div id="credit">
        <div style="height: 50%;">
            <div class="left">
                <div class="avatar">
                    <img src="img/user1.png" width="40%">
                    <br>
                    Yi Feng
                </div>

            </div>
            <div class="right">
                <div class="avatar">
                    <img src="img/user2.png"  width="40%">
                    <br>
                    Siyuan Yin
                </div>
            </div>
        </div>

        <div style="height: 50%; padding-top: 5px">
            <div class="left">
                <div class="avatar">
                    <img src="img/user3.png" width="40%">
                    <br>
                    Ming Yang
                </div>

            </div>
            <div class="right">
                <div class="avatar">
                    <img src="img/user4.png" width="40%">
                    <br>
                    Kong Hu
                </div>

            </div>
        </div>
    </div>

</div>

<!--<div id="title">-->
        <!--United Stated Senators' Funding Report (2016)-->
    <!--<button onclick="resizeCircle()">Funding</button>-->
    <!--<button onclick="topList()">Top</button>-->
    <!--<button onclick="goBack()">Go Back</button>-->
    <!--<button onclick="showReport()">Report</button>-->
    <!--<button onclick="back()">Report Back</button>-->

<!--</div>-->

<div id="stage">
    <svg id="stageSVG"></svg>
</div>

<script>

    var status = 1;

//    function refreshData(i)
//    {
//        console.log(i);
//        x = 5;
//        setTimeout(refreshData(i++), x*1000);
//    }
//
//
//    refreshData(0);

function funding() {

    if (status == 3 || status == 4) {
        goBack();
        window.setTimeout(resizeCircle, 1500);
    } else {
        resizeCircle();
    }
        status = 2;
}

    function move() {

        var elem = document.getElementById("myBar");
        var width = 1;
        var id = setInterval(frame, 80);
        function frame() {
            if (width >= 100) {
                clearInterval(id);
            } else {
                width++;
                elem.style.width = width + '%';
            }
        }
    }

    var b1 = document.getElementById('black1');
    var b2 = document.getElementById('black2');
    var b3 = document.getElementById('black3');
    var b4 = document.getElementById('black4');
    b1.style.display = 'block';
    b2.style.display = 'none';
    b3.style.display = 'none';
    b4.style.display = 'none';

    var windowWidth = window.innerWidth * 0.85;
    var windowHeight = window.innerHeight * 1;
    var stageSVG = d3.select("#stageSVG")
        .attr("width", windowWidth)
        .attr("height", windowHeight);

    var padding = 100;
    var paddingTop = 150;
    var dataSum;
    var dataCandidate;
    var dataDonation;
    var dataTop3;
    var dataInc;
    var companyToCandidate = [[0,2], [0,1,6,3,4,8,5,12], [0,2], [1,4,6,3,0,25,11,35,31,29,13,5,74,8,14], [1],[3,1,5,0,10], [0,2], [2,0], [0,2], [3,1,5,0,10], [1,4,6,3,0,25,11,35,31,29,13,5,74,8,14], [1,3],[1,4,6,3,0,25,11,35,31,29,13,5,74,8,14],[1,4,5,0,3,15,18,37,10,30,32,21,42,73], [0,1,6,3,4,8,5,12],[3,1,5,0,10], [1,4,5,0,3,15,18,37,10,30,32,21,42,73], [5,1,3]];
    var companyToCandidateMoney =  [["33,465,840", "4,819,384"], ["3,046,799","1,900,000","1,500,000","1,411,464","1,200,264","1,004,000","858,215","700,000"], ["2,980,051","4,371,362"], ["15,389,673","7,814,305","4,654,055","4,503,219","2,431,213","684,460","344,086","304,969","224,171","217,871","177,451","148,079","14,085","674","577"], ["5,925,590"],["6,240,616","5,573,540","3,069,331","260,147","46,800"], ["33,465,840", "4,819,384"], ["4,561,833","2,354,838"], ["2,980,051","4,371,362"], ["6,240,616","5,573,540","3,069,331","260,147","46,800"], ["15,389,673","7,814,305","4,654,055","4,503,219","2,431,213","684,460","344,086","304,969","224,171","217,871","177,451","148,079","14,085","674","577"], ["3,155,914","3,076,352"],["15,389,673","7,814,305","4,654,055","4,503,219","2,431,213","684,460","344,086","304,969","224,171","217,871","177,451","148,079","14,085","674","577"], ["4,068,611", "2,897,070","1,735,761","1,365,942","1,214,090","10,000","7,500","6,500","5,000","5,000","5,000","2,500","1,500","1,000"], ["3,046,799","1,900,000","1,500,000","1,411,464","1,200,264","1,004,000","858,215","700,000"],["6,240,616","5,573,540","3,069,331","260,147","46,800"], ["4,068,611", "2,897,070","1,735,761","1,365,942","1,214,090","10,000","7,500","6,500","5,000","5,000","5,000","2,500","1,500","1,000"], ["1,397,098","828,932","700,533"]];

    var div = d3.select("body").append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);

    d3.queue()
        .defer(d3.csv, "donationSenator.csv")
        .defer(d3.csv, "currentSen.csv")
        .defer(d3.csv, "sum.csv")
        .defer(d3.csv, "top3.csv")
        .defer(d3.csv, "party_Inc.csv")
        .await(function (error, candidateData, candidateList, sumData, top3Data, incData) {
            dataSum = sumData;
            dataCandidate = candidateList;
            dataDonation = candidateData;
            dataTop3 = top3Data;
            dataInc = incData;
            showCandidateCircle(candidateList);
            console.log(incData);

//            for (var i = 0; i < top3Data.length; i++) {
//                    d3.select("body").append("div")
//                        .attr("class", "tooltip")
//                        .attr("id", "tooltips" + top3Data.id)
//                        .style("opacity", 0);
//            }

        });

    function initialData() {
        var pac = ["Democratic Senatorial Campaign Cmte", "Independence USA PAC"];
        for (var i = 0; i < pac.length; i++) {
            for (var j = 0; j < dataDonation.length; j++) {
                if (dataDonation[j].pac = pac[i]) {
                    console.log(dataDonation[j].candidateId);
                }
            }
        }
    }


    var xScale = d3.scaleLinear()
        .domain([1, 22])
        .range([padding, windowWidth - padding]);
    var yScale = d3.scaleLinear()
        .domain([8, 1])
        .range([windowHeight - 100, 70]);

    function showCandidateCircle(candidateList) {

        stageSVG.append("rect")
            .attr("id", "bg")
            .attr("width", "100%")
            .attr("height", "100%")
            .attr("fill", "#eeeeee");

        for (var i = 0; i < candidateList.length; i++) {
            stageSVG.append("circle")
                .attr("cx", xScale(candidateList[i].x) - 10)
                .attr("cy",yScale(candidateList[i].y))
                .attr("id", "circle" + candidateList[i].id)
                .on("mouseover", handleMouseOverCircle)
                .on("mouseout", handleMouseOutCircle)
                .attr("r", 5)
                .attr("class", function () {
                    if (candidateList[i].party == "Republican") {
                        return "circleR";
                    } else if (candidateList[i].party == "Democrat") {
                        return "circleD";
                    } else {
                        return "circleI";
                    }
                })
                .attr("opacity", 0)
                .attr("fill", function () {
                    if (candidateList[i].party == "Republican") {
                        return "#ea212d";
                    } else if (candidateList[i].party == "Democrat") {
                        return "#1073b9";
                    } else {
                        return "green";
                    }

                })
                .transition()
                .delay(function () {
                    return Math.floor(Math.random() * 1500) + 100
                })
                .duration(1500)
                .attr("opacity", 1)
                .attr("r", 5)
                .attr("cx", xScale(candidateList[i].x) - 10)
                .attr("cy",yScale(candidateList[i].y));


            stageSVG.append("text")
                .attr("class", "firstName")
                .attr("opacity", 0)
                .attr("y", yScale(candidateList[i].y) + 15 )
                .transition()
                .delay(function () {
                    return Math.floor(Math.random() * 500) + 100
                })
                .duration(400)
                .attr("opacity", 1)
                .attr("x", xScale(candidateList[i].x) - 18)
                .attr("y", yScale(candidateList[i].y) + 25 )
                .text( "|" + candidateList[i].firstName)
                .attr("style","font-family: 'Source Sans Pro', serif; font-size: 10px;")
                .attr("fill","black");

            stageSVG.append("text")
                .attr("class", "lastName")
                .attr("opacity", 0)
                .attr("y", yScale(candidateList[i].y) + 25 )
                .transition()
                .delay(function () {
                    return Math.floor(Math.random() * 500) + 100
                })
                .duration(400)
                .attr("opacity", 1)
                .attr("x", xScale(candidateList[i].x) - 18)
                .attr("y", yScale(candidateList[i].y) + 35 )
                .text( "|" + candidateList[i].lastName)
                .attr("style","font-family: 'Source Sans Pro', serif; font-size: 10px;")
                .attr("fill","black");
        }
    }

    function resizeCircle() {
        if (status == 3 || status == 4) {
            goBack();
        }


        var b1 = document.getElementById('black1');
        var b2 = document.getElementById('black2');
        var b3 = document.getElementById('black3');
        var b4 = document.getElementById('black4');
        b1.style.display = 'none';
        b2.style.display = 'block';
        b3.style.display = 'none';
        b4.style.display = 'none';

        move();

        var rScale = d3.scaleLinear()
            .domain([0, 56501248])
            .range([10, 40]);

        for (var i = 0; i < 100; i++) {
            console.log(rScale(dataCandidate[i].donationSum));
            d3.select("#circle" + i)
                .transition()
                .delay(function () {
                    return Math.floor(Math.random() * 600) + 100
                })
                .duration(1800)
                .attr("r", function () {
                    if (rScale(dataCandidate[i].donationSum) > 20){
                        return rScale(dataCandidate[i].donationSum) - 13;
                    } else {
                        return 10;
                    }
                })
                .transition()
                .delay(function () {
                    return Math.floor(Math.random() * 600) + 100
                })
                .duration(1800)
                .attr("r", rScale(dataCandidate[i].donationSum) - 6)
                .transition()
                .delay(function () {
                    return Math.floor(Math.random() * 600) + 100
                })
                .duration(1800)
                .attr("r", rScale(dataCandidate[i].donationSum) - 3)
                .transition()
                .duration(1800)
                .attr("r", rScale(dataCandidate[i].donationSum) );
        }
    }


    function topList() {

        status = 3
        var b1 = document.getElementById('black1');
        var b2 = document.getElementById('black2');
        var b3 = document.getElementById('black3');
        var b4 = document.getElementById('black4');
        b1.style.display = 'none';
        b2.style.display = 'none';
        b3.style.display = 'block';
        b4.style.display = 'none';

        clearReport();
        d3.selectAll(".circleI")
            .attr("opacity", 1);

        d3.selectAll(".circleParty")
            .transition()
            .duration(1000)
            .attr("r", 0);

        d3.selectAll(".circleParty")
            .transition()
            .delay(1000)
            .remove();

        d3.selectAll(".total")
            .transition()
            .duration(300)
            .attr("r", 0);

        d3.selectAll(".total")
            .transition()
            .delay(300)
            .remove();



        removeText();
        moveCircles();
        showImg();


    }

    function removeText() {
        d3.selectAll(".firstName")
            .transition()
            .duration(500)
            .attr("opacity", 0);

        d3.selectAll(".lastName")
            .transition()
            .duration(500)
            .attr("opacity", 0);

        d3.selectAll(".firstName")
            .transition()
            .delay(500)
            .remove();

        d3.selectAll(".lastName")
            .transition()
            .delay(500)
            .remove();

        d3.selectAll(".rank")
            .transition()
            .duration(500)
            .attr("opacity", 0);

        d3.selectAll(".rank")
            .transition()
            .delay(500)
            .remove();
    }

    function moveCircles() {
        for (var i = 0; i < 6; i++) {
            d3.select("#circle" + i)
//                .on("mouseover", mouseOverNoAction)
//                .on("mouseout", mouseOverNoAction)
                .transition()
                .duration(1000)
                .attr("cx", xScale(1))
                .attr("cy", yScale(i + 1) * 1.3)
                .attr("r", 35);

            stageSVG
                .append("svg:image")
                .attr("class", "img")
                .attr("id", "s" + i)
                .attr('x',xScale(1) - 35)
                .attr('y',yScale(i + 1) * 1.3 - 35)
                .attr('width', 70)
                .attr("opacity", 0)
                .attr("xlink:href","img/s" + i + ".png")
                .transition()
                .delay( 500 + i * 100)
                .duration(500)
                .attr("opacity", 1);


            stageSVG.append("text")
                .attr("class", "firstName")
                .attr("id", "textF" + i)
                .attr("y", yScale(i + 1) * 1.3)
                .attr("opacity", 0)
                .transition()
                .delay(1000)
                .duration(function () {
                    return Math.floor(Math.random() * 700) + 300
                })
                .attr("opacity", 1)
                .attr("x", xScale(1) + 50)
                .attr("y", yScale(i + 1) * 1.3-4)
                .text( "|" + dataCandidate[i].firstName)
                .attr("style","font-family: 'Source Sans Pro', serif; font-size: 10px;");



            stageSVG.append("text")
                .attr("class", "lastName")
                .attr("id", "textL" + i)
                .attr("y", yScale(i + 1) * 1.3 - 4)
                .attr("opacity", 0)
                .transition()
                .delay(1000)
                .duration(function () {
                    return Math.floor(Math.random() * 700) + 300
                })
                .attr("opacity", 1)
                .attr("x", xScale(1) + 50)
                .attr("y", yScale(i + 1) * 1.3 + 9)
                .text( "|" + dataCandidate[i].lastName)
                .attr("style","font-family: 'Source Sans Pro', serif; font-size: 10px;");

            stageSVG.append("text")
                .attr("class", "rank")
                .attr("id", "rank" + i)
                .attr("y", yScale(i + 1) * 1.3 - 8)
                .attr("opacity", 0)
                .transition()
                .delay(1000)
                .duration(400)
                .attr("opacity", 1)
                .attr("x", xScale(1) + 100)
                .attr("y", yScale(i + 1) * 1.3)
                .text( "#" + (i + 1) )
                .attr("style","font-family: 'Source Sans Pro', serif; font-size: 10px;");



        }

        var tempXScale = d3.scaleLinear()
            .domain([1, 6])
            .range([windowWidth * 0.7, windowWidth - 20 ]);

        var tempYScale = d3.scaleLinear()
            .domain([1, 16])
            .range([windowHeight - 50, paddingTop]);

        var count = 1;
        var row = 1;
        for (var i = 6; i < dataCandidate.length; i++) {
            if (count == 6) {
                count = 1;
                row++;
            }

            d3.select("#circle" + i)
//                .on("mouseover", mouseOverNoAction)
//                .on("mouseout", mouseOverNoAction)
                .transition()
                .duration(1000)
                .attr("r", 10)
                .attr("cx", tempXScale(count))
                .attr("cy", tempYScale(row));

            stageSVG.append("text")
                .attr("class", "firstName")
                .attr("id", "textF" + i)
                .attr("y", tempYScale(row) - 5)
                .attr("opacity", 0)
                .transition()
                .delay(1000)
                .duration(function () {
                    return Math.floor(Math.random() * 700) + 300
                })
                .attr("opacity", 1)
                .attr("x", tempXScale(count) + 15)
                .attr("y", tempYScale(row) + 2)
                .text( "|" + dataCandidate[i].firstName)
                .attr("style","font-family: 'Source Sans Pro', serif; font-size: 10px;");


            count++
        }
    }

    function mouseOverNoAction() {

    }

    function showImg() {
        var imgScaleX = d3.scaleLinear()
            .domain([1, 3])
            .range([xScale(4), windowWidth * 0.5]);

        var row = 1;
        var count = 1;
        for (var i = 1; i < 19; i++) {
            stageSVG
                .append("svg:image")
                .attr("id", "p" + (i - 1))
                .on("mouseover", handleMouseOver)
                .on("mouseout", handleMouseOut)
                .attr("class", "img")
                .attr('x',imgScaleX(count))
                .attr('y',yScale(row) * 1.3 - 30)
                .attr('width', 160)
                .attr("opacity", 0)
                .attr("xlink:href","img/"+ (i)+".png")
                .transition()
                .delay(function () {
                    return Math.floor(Math.random() * 1300) + 50
                })
                .duration(1000)
                .attr("opacity", 1);
            count++;
            if (count == 4) {
                count = 1;
                row++;
            }
        }
    }
    
    function handleMouseOverCircle() {
        console.log(this.cx.animVal.value);
        div.transition()
            .duration(200)
            .style("opacity", .9);

        if (this.id.substr(6) == "96" || this.id.substr(6) == "97" || this.id.substr(6) == "98" || this.id.substr(6) == "92" || this.id.substr(6) == "93" || this.id.substr(6) == "94" || this.id.substr(6) == "95" || this.id.substr(6) == "99" ){
            div.html("This person didn't receive any funding last year.")
                .style("left", (d3.event.pageX) + "px")
                .style("top", (d3.event.pageY - 28) + "px");
        } else {
            console.log(dataTop3);
            console.log(this.id);
            div.html("Top 3 Sponsors:"+"<br>" + dataTop3[this.id.substr(6)].Top1PAC + ": <br>" + "$" +dataTop3[this.id.substr(6)].Top1Value + "<br>"
                + dataTop3[this.id.substr(6)].Top2PAC + ": <br>" + "$" +dataTop3[this.id.substr(6)].Top2Value + "<br>"
                + dataTop3[this.id.substr(6)].Top3PAC + ": <br>" + "$" +dataTop3[this.id.substr(6)].Top3Value
            )
                .style("left", (d3.event.pageX) + "px")
                .style("top", (d3.event.pageY - 28) + "px");
        }


    }
    
    function handleMouseOutCircle() {

        div.transition()
            .duration(500)
            .style("opacity", 0);

    }

    function handleMouseOver() {

//        console.log(this.x.animVal.value);

        for (var i = 0; i < dataCandidate.length; i++) {
            var id = this.id.substr(1);
            if (companyToCandidate[id].includes(i)) {
                d3.select("#circle" + i)
                    .transition()
                    .duration(800)
                    .attr("r", 40)
                    .attr("fill", function () {
                        if (dataCandidate[i].party == "Republican") {
                            return "#ea212d";
                        } else if (dataCandidate[i].party == "Democrat") {
                            return "#1073b9";
                        } else {
                            return "green";
                        }

                    })
                    .attr("opacity", 1);

                d3.select("#s" + i)
                    .transition()
                    .duration(800)
                    .attr("opacity", 1)

            } else {
                if (i < 6) {
                    d3.select("#circle" + i)
                        .transition()
                        .duration(800)
                        .attr("r", 35)
                        .attr("fill", "#CFCFCF")
                        .attr("opacity", 0.3);
                    d3.select("#textL" + i)
                        .transition()
                        .duration(800)
                        .attr("opacity", 0.1);

                    d3.select("#s" + i)
                        .transition()
                        .duration(800)
                        .attr("opacity", 0.1)


                } else {
                    d3.select("#circle" + i)
                        .transition()
                        .duration(800)
                        .attr("r", 10)
                        .attr("fill", "#CFCFCF")
                        .attr("opacity", 0.3);
                }

                d3.select("#textF" + i)
                    .transition()
                    .duration(800)
                    .attr("opacity", 0.1);


            }

            d3.selectAll(".rank")
                .transition()
                .duration(800)
                .attr("opacity", 0.1);


        }


        for (var i = 0; i < companyToCandidate[id].length; i++) {

            if (companyToCandidate[id][i] < 6) {
                stageSVG.append("line")
                    .style("stroke", "black")
                    .attr("stroke-width", 2)
                    .attr("opacity", 0.3)
                    .attr("class","line")
                    .style("stroke-dasharray", ("3, 3"))
                    .attr("x1", parseInt(d3.select("#p" + id).attr("x")))
                    .attr("y1", parseInt(d3.select("#p" + id).attr("y")) + 30)
                    .attr("x2", parseInt(d3.select("#p" + id).attr("x")))
                    .attr("y2", parseInt(d3.select("#p" + id).attr("y")) + 30)
                    .transition()
                    .duration(500)
                    .attr("x2", parseInt(d3.select("#p" + id).attr("x")) - 20)
                    .attr("y2", parseInt(d3.select("#p" + id).attr("y")) + 30);
                break;
            }
        }

        for (var i = 0; i < companyToCandidate[id].length; i++) {

            if (companyToCandidate[id][i] >= 6) {
                stageSVG.append("line")
                    .style("stroke", "black")
                    .attr("stroke-width", 2)
                    .attr("opacity", 0.3)
                    .attr("class","line")
                    .style("stroke-dasharray", ("3, 3"))
                    .attr("x1", parseInt(d3.select("#p" + id).attr("x")) + 160)
                    .attr("y1", parseInt(d3.select("#p" + id).attr("y")) + 30)
                    .attr("x2", parseInt(d3.select("#p" + id).attr("x")) + 160)
                    .attr("y2", parseInt(d3.select("#p" + id).attr("y")) + 30)
                    .transition()
                    .duration(500)
                    .attr("x2", parseInt(d3.select("#p" + id).attr("x")) + 180)
                    .attr("y2", parseInt(d3.select("#p" + id).attr("y")) + 30);
                break;
            }
        }




       for (var i = 0; i < companyToCandidate[id].length; i++) {

           if (companyToCandidate[id][i] < 6) {
               stageSVG.append("line")
                   .style("stroke", "black")
                   .attr("stroke-width", 2)
                   .attr("opacity", 0.3)
                   .attr("class","line")
                   .style("stroke-dasharray", ("3, 3"))
                   .attr("x1", parseInt(d3.select("#circle" + companyToCandidate[id][i]).attr("cx")) + 100)
                   .attr("y1", parseInt(d3.select("#circle" + companyToCandidate[id][i]).attr("cy")))
                   .attr("x2", parseInt(d3.select("#circle" + companyToCandidate[id][i]).attr("cx")) + 100)
                   .attr("y2", parseInt(d3.select("#circle" + companyToCandidate[id][i]).attr("cy")))
                   .transition()
                   .delay(450)
                   .duration(500)
                   .attr("x2", parseInt(d3.select("#circle" + companyToCandidate[id][i]).attr("cx")) + 40)
                   .attr("y2", parseInt(d3.select("#circle" + companyToCandidate[id][i]).attr("cy")));

               stageSVG.append("line")
                   .style("stroke", "black")
                   .attr("stroke-width", 2)
                   .attr("opacity", 0.3)
                   .attr("class","line")
                   .style("stroke-dasharray", ("3, 3"))
                   .attr("x1", parseInt(d3.select("#p" + id).attr("x")) - 20)
                   .attr("y1", parseInt(d3.select("#p" + id).attr("y")) + 30)
                    .attr("x2", parseInt(d3.select("#p" + id).attr("x")) - 20)
                   .attr("y2", parseInt(d3.select("#p" + id).attr("y")) + 30)
                   .transition()
                   .delay(400)
                   .duration(500)
                   .attr("x1", parseInt(d3.select("#p" + id).attr("x")) - 20)
                   .attr("y1", parseInt(d3.select("#p" + id).attr("y")) + 30)
                   .attr("x2", parseInt(d3.select("#circle" + companyToCandidate[id][i]).attr("cx")) + 100)
                   .attr("y2", parseInt(d3.select("#circle" + companyToCandidate[id][i]).attr("cy")));

               stageSVG.append("text")
                   .attr("class", "amount")
                   .attr("opacity", 0)
                   .attr("x", parseInt(d3.select("#circle" + companyToCandidate[id][i]).attr("cx")) + 40)
                   .attr("y", parseInt(d3.select("#circle" + companyToCandidate[id][i]).attr("cy")) - 0)
                   .transition()
                   .delay(500)
                   .duration(400)
                   .attr("opacity", 1)
                   .text( "$" + companyToCandidateMoney[id][i])
                   .attr("style","font-family: 'Source Sans Pro', serif; font-size: 14px;")
                   .attr("y", parseInt(d3.select("#circle" + companyToCandidate[id][i]).attr("cy")) - 20)
                   .attr("fill","black");


           } else {
               stageSVG.append("line")
                   .style("stroke", "black")
                   .attr("stroke-width", 2)
                   .attr("opacity", 0.3)
                   .attr("class","line")
                   .style("stroke-dasharray", ("3, 3"))
                   .attr("x1", parseInt(d3.select("#circle" + companyToCandidate[id][i]).attr("cx")) - 90)
                   .attr("y1", parseInt(d3.select("#circle" + companyToCandidate[id][i]).attr("cy")))
                   .attr("x2", parseInt(d3.select("#circle" + companyToCandidate[id][i]).attr("cx")) - 90)
                   .attr("y2", parseInt(d3.select("#circle" + companyToCandidate[id][i]).attr("cy")) )
                   .transition()
                   .delay(450)
                   .duration(500)
                   .attr("x2", parseInt(d3.select("#circle" + companyToCandidate[id][i]).attr("cx")) - 40)
                   .attr("y2", parseInt(d3.select("#circle" + companyToCandidate[id][i]).attr("cy")) );

               stageSVG.append("line")
                   .style("stroke", "black")
                   .attr("stroke-width", 2)
                   .attr("opacity", 0.3)
                   .attr("class","line")
                   .style("stroke-dasharray", ("3, 3"))
                   .attr("x1", parseInt(d3.select("#p" + id).attr("x")) + 180)
                   .attr("y1", parseInt(d3.select("#p" + id).attr("y")) + 30)
                   .attr("x2", parseInt(d3.select("#p" + id).attr("x")) + 180)
                   .attr("y2", parseInt(d3.select("#p" + id).attr("y")) + 30)
                   .transition()
                   .delay(300)
                   .duration(500)
                   .attr("x1", parseInt(d3.select("#p" + id).attr("x")) + 180)
                   .attr("y1", parseInt(d3.select("#p" + id).attr("y")) + 30)
                   .attr("x2", parseInt(d3.select("#circle" + companyToCandidate[id][i]).attr("cx")) - 90)
                   .attr("y2", parseInt(d3.select("#circle" + companyToCandidate[id][i]).attr("cy")) );

               stageSVG.append("text")
                   .attr("class", "amount")
                   .attr("opacity", 0)
                   .attr("x", parseInt(d3.select("#circle" + companyToCandidate[id][i]).attr("cx")) - 70)
                   .attr("y", parseInt(d3.select("#circle" + companyToCandidate[id][i]).attr("cy")) )
                   .transition()
                   .delay(500)
                   .duration(400)
                   .attr("opacity", 1)
                   .text( "$" + companyToCandidateMoney[id][i])
                   .attr("style","font-family: 'Source Sans Pro', serif; font-size: 14px;")
                   .attr("y", parseInt(d3.select("#circle" + companyToCandidate[id][i]).attr("cy")) - 20)
                   .attr("fill","black");

           }


           console.log(companyToCandidate[id]);
       }



        for (var i = 0; i < 18; i++) {
            var id = this.id.substr(1);
            if (i != id) {
                d3.select("#p" + i)
                    .transition()
                    .duration(800)
                    .attr("opacity", 0.1);

            }
        }
    }

    function handleMouseOut() {

        d3.selectAll(".lastName")
            .transition()
            .duration(800)
            .attr("opacity", 1);

        d3.selectAll(".firstName")
            .transition()
            .duration(800)
            .attr("opacity", 1);

        d3.selectAll(".rank")
            .transition()
            .duration(800)
            .attr("opacity", 1);

        for (var i = 0; i < 6; i++) {
            d3.select("#circle" + i)
                .transition()
                .duration(800)
                .attr("r", 35)
                .attr("fill", function () {
                    if (dataCandidate[i].party == "Republican") {
                        return "#ea212d";
                    } else if (dataCandidate[i].party == "Democrat") {
                        return "#1073b9";
                    } else {
                        return "green";
                    }

                })
                .attr("opacity", 1);
        }

        for (var i = 6; i < dataCandidate.length; i++) {
            d3.select("#circle" + i)
                .transition()
                .duration(800)
                .attr("r", 10)
                .attr("fill", function () {
                    if (dataCandidate[i].party == "Republican") {
                        return "#ea212d";
                    } else if (dataCandidate[i].party == "Democrat") {
                        return "#1073b9";
                    } else {
                        return "green";
                    }

                })
                .attr("opacity", 1);
        }

        d3.selectAll(".img")
            .transition()
            .duration(800)
            .attr("opacity", 1);

        d3.selectAll(".line")
            .transition()
            .duration(800)
            .attr("opacity", 0);

        d3.selectAll(".line")
            .transition()
            .delay(800)
            .remove();

        d3.selectAll(".amount")
            .transition()
            .duration(800)
            .attr("opacity", 0);

        d3.selectAll(".amount")
            .transition()
            .delay(800)
            .remove();


    }

    function goBack() {

        status = 1;

        var b1 = document.getElementById('black1');
        var b2 = document.getElementById('black2');
        var b3 = document.getElementById('black3');
        var b4 = document.getElementById('black4');
        b1.style.display = 'block';
        b2.style.display = 'none';
        b3.style.display = 'none';
        b4.style.display = 'none';


        clearReport();

        d3.selectAll(".firstName")
            .transition()
            .duration(500)
            .attr("opacity", 0);

        d3.selectAll(".firstName")
            .transition()
            .delay(500)
            .remove();

        d3.selectAll(".lastName")
            .transition()
            .duration(500)
            .attr("opacity", 0);

        d3.selectAll(".lastName")
            .transition()
            .delay(500)
            .remove();

        d3.selectAll(".img")
            .transition()
            .duration(500)
            .attr("opacity", 0);

        d3.selectAll(".img")
            .transition()
            .delay(500)
            .remove();

        d3.selectAll(".rank")
            .transition()
            .duration(500)
            .attr("opacity", 0);

        d3.selectAll(".rank")
            .transition()
            .delay(500)
            .remove();

        d3.selectAll(".circleParty")
            .transition()
            .duration(1000)
            .attr("r", 0);

        d3.selectAll(".circleParty")
            .transition()
            .delay(1000)
            .remove();

        d3.selectAll(".total")
            .transition()
            .duration(300)
            .attr("r", 0);

        d3.selectAll(".total")
            .transition()
            .delay(300)
            .remove();


        for (var i = 0; i < dataCandidate.length; i++) {
            d3.select("#circle" + i)
                .transition()
                .duration(function () {
                    return Math.floor(Math.random() * 1000) + 700
                })
                .attr("opacity", 1)
                .attr("r", 5)
                .attr("cx", xScale(dataCandidate[i].x) - 10)
                .attr("cy",yScale(dataCandidate[i].y));


            stageSVG.append("text")
                .attr("class", "firstName")
                .attr("opacity", 0)
                .attr("y", yScale(dataCandidate[i].y) + 15 )
                .transition()
                .delay(function () {
                    return Math.floor(Math.random() * 500) + 100
                })
                .duration(400)
                .attr("opacity", 1)
                .attr("x", xScale(dataCandidate[i].x) - 18)
                .attr("y", yScale(dataCandidate[i].y) + 25 )
                .text( "|" + dataCandidate[i].firstName)
                .attr("style","font-family: 'Source Sans Pro', serif; font-size: 10px;")
                .attr("fill","black");

            stageSVG.append("text")
                .attr("class", "lastName")
                .attr("opacity", 0)
                .attr("y", yScale(dataCandidate[i].y) + 25 )
                .transition()
                .delay(function () {
                    return Math.floor(Math.random() * 500) + 100
                })
                .duration(400)
                .attr("opacity", 1)
                .attr("x", xScale(dataCandidate[i].x) - 18)
                .attr("y", yScale(dataCandidate[i].y) + 35 )
                .text( "|" + dataCandidate[i].lastName)
                .attr("style","font-family: 'Source Sans Pro', serif; font-size: 10px;")
                .attr("fill","black");
        }
    }

    function removeImg() {


        d3.selectAll(".img")
            .transition()
            .duration(500)
            .attr("opacity", 0);


        d3.selectAll(".img")
            .transition()
            .delay(500)
            .remove();
    }

    function showPartyCircle() {

        var rA = 0;
        var dA = 0;
        for (var i = 0; i < dataInc.length; i++) {
            rA = rA + parseInt(dataInc[i].Republican);
            dA = dA + parseInt(dataInc[i].Democratic);
        }

        console.log(rA);
        console.log(dA);

        var circleScale = d3.scaleLinear()
            .domain([dA, rA])
            .range([40, 80]);

        stageSVG.append("circle")
            .attr("cx", xScale(2))
            .attr("cy",yScale(4))
            .attr("class", "circleParty")
            .attr("id", "circleR")
            .attr("r", 0)
            .attr("opacity", 1)
            .attr("fill", "#ea212d")
            .transition()
            .delay(0)
            .duration(1500)
            .attr("opacity", 1)
            .attr("r", circleScale(rA));


        stageSVG.append("text")
            .attr("class", "total")
            .attr("opacity", 0)
            .attr("x", xScale(2))
            .attr("y", yScale(4))
            .attr("fill", "white")
            .transition()
            .delay(500)
            .duration(400)
            .attr("opacity", 1)
            .attr("x", xScale(2) - 20)
            .attr("y", yScale(4) + 3 )
            .text( "$" + rA)
            .attr("style","font-family: 'Source Sans Pro', serif; font-size: 14px;");

        stageSVG.append("circle")
            .attr("cx", xScale(21))
            .attr("cy",yScale(4))
            .attr("class", "circleParty")
            .attr("id", "circleD")
            .attr("r", 0)
            .attr("opacity", 1)
            .attr("fill", "#1073b9")
            .transition()
            .delay(0)
            .duration(1500)
            .attr("opacity", 1)
            .attr("r", circleScale(dA));


        stageSVG.append("text")
            .attr("class", "total")
            .attr("opacity", 0)
            .attr("x", xScale(2))
            .attr("y", yScale(4))
            .attr("fill", "white")
            .transition()
            .delay(500)
            .duration(400)
            .attr("opacity", 1)
            .attr("x", xScale(21) - 20)
            .attr("y", yScale(4) + 3 )
            .text( "$" + dA)
            .attr("style","font-family: 'Source Sans Pro', serif; font-size: 14px;");

        d3.selectAll(".circleR")
            .transition()
            .duration(function () {
                return Math.floor(Math.random() * 1500) + 500
            })
            .attr("cx", xScale(2))
            .attr("cy", yScale(4))
            .attr("r", 5);

        d3.selectAll(".circleD")
            .transition()
            .duration(function () {
                return Math.floor(Math.random() * 1500) + 500
            })
            .attr("cx", xScale(21))
            .attr("cy", yScale(4))
            .attr("r", 5);

        d3.selectAll(".circleI")
            .transition()
            .duration(1000)
            .attr("opacity", 0);

        d3.select("#bg")
            .transition()
            .duration(500)
            .attr("fill", "#eeeeee");

    }
    
    function showReport() {

        status = 4;
        var b1 = document.getElementById('black1');
        var b2 = document.getElementById('black2');
        var b3 = document.getElementById('black3');
        var b4 = document.getElementById('black4');
        b1.style.display = 'none';
        b2.style.display = 'none';
        b3.style.display = 'none';
        b4.style.display = 'block';

        removeText();
        removeImg();
        showPartyCircle();
        showMiddleLine();

        showBars();
        showLogos();

        window.setTimeout(moveLogos, 3000);
    }

    function showBars() {
        var yScaleLogo = d3.scaleLinear()
            .domain([0, 9])
            .range([50, windowHeight - 100]);
        var rMax = 0;
        var dMax = 0;
        var rA = 0;
        var dA = 0;
        for (var i = 0; i < dataInc.length; i++) {
            rA = rA + dataInc[i].Republican;
            dA = dA + dataInc[i].Democratic;
            if (parseInt(dataInc[i].Democratic) > dMax) {
                dMax = parseInt(dataInc[i].Democratic);
            }
            if (parseInt(dataInc[i].Republican) > rMax) {
                rMax = parseInt(dataInc[i].Republican);
            }
        }


        var max = rMax;
        if (max < dMax) {
            max = dMax;
        }


        var dScale = d3.scaleLinear()
            .domain([0, max])
            .range([windowWidth / 2, windowWidth / 2 + 300]);

        var rScale = d3.scaleLinear()
            .domain([0, max])
            .range([windowWidth / 2, windowWidth / 2 - 300]);

        for (var i = 0; i < dataInc.length; i++) {
            stageSVG.append("line")
                .style("stroke", "#1073b9")
                .attr("stroke-width", 5)
                .attr("stroke-linecap","round")
                .attr("radius",50)
                .attr("opacity", 1)
                .attr("class","bar")
                .attr("fill","#1073b9")
                .attr("x1", windowWidth / 2)
                .attr("y1", yScaleLogo(i) + 20)
                .attr("x2", windowWidth / 2)
                .attr("y2", yScaleLogo(i) + 20)
                .transition()
                .delay(100 * i + 1000)
                .duration(400)
                .attr("x2",dScale(dataInc[i].Democratic));


            stageSVG.append("line")
                .style("stroke", "#ea212d")
                .attr("stroke-width", 5)
                .attr("stroke-linecap","round")
                .attr("radius",50)
                .attr("opacity", 1)
                .attr("class","bar")
                .attr("fill","#ea212d")
                .attr("x1", windowWidth / 2)
                .attr("y1", yScaleLogo(i) + 20)
                .attr("x2", windowWidth / 2)
                .attr("y2", yScaleLogo(i) + 20)
                .transition()
                .delay(100 * i + 1000)
                .duration(400)
                .attr("x2",rScale(dataInc[i].Republican));

            stageSVG.append("text")
                .attr("class", "rAmount")
                .attr("opacity", 0)
                .attr("x", rScale(dataInc[i].Republican) + 30)
                .attr("y", yScaleLogo(i) + 24 )
                .transition()
                .delay(2000)
                .duration(400)
                .attr("opacity", 1)
                .attr("x", rScale(dataInc[i].Republican) - 60)
                .attr("y", yScaleLogo(i) + 24 )
                .text( "$" + dataInc[i].Republican)
                .attr("style","font-family: 'Source Sans Pro', serif; font-size: 10px;")
                .attr("fill","black");

            stageSVG.append("text")
                .attr("class", "dAmount")
                .attr("opacity", 0)
                .attr("x", dScale(dataInc[i].Democratic) - 16)
                .attr("y", yScaleLogo(i) + 24 )
                .transition()
                .delay(2000)
                .duration(400)
                .attr("opacity", 1)
                .attr("x", dScale(dataInc[i].Democratic) + 30)
                .attr("y", yScaleLogo(i) + 24)
                .text( "$" + dataInc[i].Democratic)
                .attr("style","font-family: 'Source Sans Pro', serif; font-size: 10px;")
                .attr("fill","black");

        }


    }

    function showMiddleLine() {
        stageSVG.append("line")
            .style("stroke", "black")
            .attr("stroke-width", 2)
            .attr("opacity", 0.3)
            .attr("class","line")
            .style("stroke-dasharray", ("3, 3"))
            .attr("x1", windowWidth / 2)
            .attr("y1", 50)
            .attr("x2", windowWidth / 2)
            .attr("y2", 50)
            .transition()
            .delay(500)
            .duration(600)
            .attr("x2", windowWidth / 2)
            .attr("y2", windowHeight - 50);
    }

    function showLogos() {

        var yScaleLogo = d3.scaleLinear()
            .domain([0, 9])
            .range([50, windowHeight - 100]);

        for (var i = 0; i < 10; i++) {
            stageSVG
                .append("svg:image")
                .attr("id", "logo" + i)
                .attr("class", "img")
                .attr('x',windowWidth / 2 - 50)
                .attr('y',yScaleLogo(i))
                .attr('width', 100)
                .attr("opacity", 0)
                .attr("xlink:href","img/c"+ (i + 1)+".png")
                .transition()
                .delay(i * 100 + 100)
                .duration(1000)
                .attr("opacity", 1);
        }


    }
    
    function moveLogos() {
        var array = [];

        for (var i = 0; i < dataInc.length; i++) {
            temp = parseInt(dataInc[i].Democratic) / parseInt(dataInc[i].Republican);
            array.push(temp);
        }


        var logoScalePos = d3.scaleLinear()
            .domain([1, d3.max(array)])
            .range([windowWidth / 2 , windowWidth / 2 + 70]);

        var logoScaleNeg = d3.scaleLinear()
            .domain([d3.min(array), 1])
            .range([windowWidth / 2 - 70, windowWidth / 2]);

        for (var i = 0; i < dataInc.length; i++) {
            d3.select("#logo" + i)
                .transition()
                .duration(1000)
                .attr("x", function () {
                    if (array[i] > 1) {
                        return logoScalePos(array[i]);
                    } else {
                        console.log(array[i]);
                        return logoScaleNeg(array[i]) - 50;
                    }
                });
        }
    }


    function back() {
        d3.selectAll(".circleParty")
            .transition()
            .duration(300)
            .attr("r", 0);

        d3.selectAll(".circleParty")
            .transition()
            .delay(300)
            .remove();

        for (var i = 0; i < dataCandidate.length; i++) {
            d3.select("#circle" + i)
                .transition()
                .duration(function () {
                    return Math.floor(Math.random() * 300) + 200
                })
                .attr("opacity", 1)
                .attr("r", 5)
                .attr("cx", function () {
                    return Math.floor(Math.random() * (windowWidth - 170)) + 100
                })
                .attr("cy",function () {
                    return Math.floor(Math.random() * (windowHeight - 170)) + 100
                })
                .attr("r", function () {
                    return Math.floor(Math.random() * 10) + 3
                });
        }

        window.setTimeout(goBack, 700);
    }

    function clearReport() {


        d3.selectAll(".bar")
            .remove();


        d3.selectAll(".line")
            .remove();



        d3.selectAll(".rAmount")
            .remove();



        d3.selectAll(".dAmount")
            .remove();



        d3.selectAll(".img")
            .remove();
    }
</script>

</body>
</html>